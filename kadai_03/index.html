<!DOCTYPE html>
<html lang="ja">



<head>
  <meta charset="utf-8" />
  <title>Chatã‚¢ãƒ—ãƒª</title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <!-- <script src="js/login.js"></script> -->

  <div class="hwrapper">
    <div class="header">
        <div class="logo"><img class="mainimage" src="img/mainimage.png" alt=""></div>
        <div class="title">ART Chat</div>
    </div>
  </div>
  

  <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->
  <!-- ç”»åƒ -->
  <main>
  <div class="flex-container">
    <h2>Type of Art</h2> 
    
    <figure>
      <img class="icon" data-img="0" src="img/icon01.jpg" alt="">
      <figcaption>
        <p>è¥¿æ´‹ç”»</p>
      </figcaption>
    </figure>
    <figure>
      <img class="icon" data-img="1" src="img/icon02.jpg" alt="">
      <figcaption>
        <p>æ—¥æœ¬ç”»</p>
      </figcaption>
    </figure>
    <figure>
      <img class="icon" data-img="2" src="img/icon03.jpg" alt="">
      <figcaption>
        <p>ç¾ä»£ã‚¢ãƒ¼ãƒˆ</p>
      </figcaption>
    </figure>
    <figure>
      <img class="icon" data-img="3" src="img/icon04.jpg" alt="">
      <figcaption>
        <p>å·¥èŠ¸</p>
      </figcaption>
    </figure>
    <figure>
      <img class="icon" data-img="4" src="img/icon05.jpg" alt="">
      <figcaption>
        <p>å†™çœŸ</p>
      </figcaption>
    </figure>
    <figure>
      <img class="icon" data-img="5" src="img/icon06.jpg" alt="">
      <figcaption>
        <p>å»ºç¯‰</p>
      </figcaption>
    </figure>
  </div>
  <div class="form_container">
    <form method="POST" autocomplete="off">
      <!--å…¥åŠ›å€™è£œã‚’OFFã«ã™ã‚‹-->
      <div>
        <!-- åå‰ -->
        <input type="text" id="username" placeholder="Name">
      </div>

      <div>
        <!-- ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ -->
        <textarea name="" id="text" placeholder="Text"></textarea>
      </div>
    </form>
      <!-- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
      <!-- <input id="file" name="file" type="file"> -->
      <!-- <input type="range" min="0" max="100" value="50" id="a1"> -->
      <!-- <div>
        <img id="result" width="300">
      </div> -->

    <div>
      <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
      <a href="#" class="send">é€ä¿¡</a>
    </div>
  </div>
  <div class="chat_container">
    <div class="chatlog">
      <!-- ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹ç®‡æ‰€ -->
      <div id="output"></div>
    </div>
  </div>
  
  </main>
  
  
  <!--/ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->

  <!-- JQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <!-- JQuery -->

  <!--** ä»¥ä¸‹Firebase **-->
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <!-- 6.6.1ã«è©²å½“ã™ã‚‹ç®‡æ‰€ã¯firebaseã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã™ã®ã§æ›´æ–°ã•ã‚Œã‚‹ãŸã³ã«éšæ™‚å¤‰ã‚ã‚Šã¾ã™ğŸ¤— -->
  <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#config-web-app -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/ja.min.js"></script>

  <script>
    $(function ()
      {
        $(".title").fadeIn("slow");
        $(".mainimage").fadeIn("slow");
      });

    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyBG-vT6p5RhNd6wu2IINCAhXOynCcqNl3Q",
      authDomain: "dev20chat-1e7df.firebaseapp.com",
      databaseURL: "https://dev20chat-1e7df-default-rtdb.firebaseio.com/",
      projectId: "dev20chat-1e7df",
      storageBucket: "dev20chat-1e7df.appspot.com",
      messagingSenderId: "723601182317",
      appId: "1:723601182317:web:08efaad686993674bd3964"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    //firebaseã®ãƒ‡ãƒ¼ã‚¿ãƒ¼ãƒ™ãƒ¼ã‚¹ï¼ˆä¿å­˜ã•ã›ã‚‹å ´æ‰€ï¼‰ã‚’ä½¿ã„ã¾ã™ã‚ˆ
    const newPostRef = firebase.database().ref();

    // ã“ã“ã‹ã‚‰ä¸‹ã«jqueryã®å‡¦ç†ã‚’æ›¸ã„ã¦ç·´ç¿’ã—ã¾ã™

    // ã‚¢ã‚¤ã‚³ãƒ³
    let d = 0;
    const img = ["icon01.jpg", "icon02.jpg", "icon03.jpg", "icon04.jpg", "icon05.jpg", "icon06.jpg",]
    $(".icon").on("click", function ()
    {
      console.log(this);
      d = $(this).attr("data-img") //attrâ†’data-imgã®å±æ€§ã‚’å–å¾—
    })

    // æ—¥æ™‚
    const t = moment().format('YYYY/MM/DD HH:mm');

    // ç”»åƒ
    //ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ãŸã‚‰:changeã‚¤ãƒ™ãƒ³ãƒˆ
    // document.querySelector("#file").onchange = function ()
    // {
    //   // å„FileAPIãŒä½¿ç”¨å¯èƒ½ã§ã‚ã‚Œã°ä¸­ã‚’å‡¦ç†ã—ã¦ã„ã
    //   if (window.File && window.FileReader && window.FileList && window.Blob)
    //   {
    //     const input = document.querySelector("#file").files[0];
    //     const reader = new FileReader();  //1
    //     //å¤±æ•—ã‚¤ãƒ™ãƒ³ãƒˆï¼šã‚¨ãƒ©ãƒ¼è¡¨ç¤º
    //     reader.onerror = function ()
    //     {
    //       alert("èª­ã¿å–ã‚Šæ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
    //     };
    //     //æˆåŠŸã‚¤ãƒ™ãƒ³ãƒˆï¼šèª­ã¿è¾¼ã‚“ã ç”»åƒã‚’#resultã«è¡¨ç¤º
    //     reader.onload = function ()
    //     {
    //       document.querySelector("#result").src = reader.result;

    //     }
        
    //     //ç”»åƒèª­ã¿è¾¼ã¿å‡¦ç†
    //     reader.readAsDataURL(input);   //2
    //   }
    // }
    // é€ä¿¡ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰æ¬¡ã®å‡¦ç†ã‚’ã™ã‚‹
    $(".send").on("click", function ()
    {
      let userNamevalue = $("#username").val();
      if (userNamevalue == "")
      {
        alert("å…¥åŠ›ã•ã‚Œã¦ã¾ã›ã‚“");
        return
      }
    })

    $(".send").on("click", function ()
    {

      newPostRef.push({
        username: $("#username").val(),
        text: $("#text").val(),
        icon: d,
        time: t,
      })
      $("#text").val("");
      $("#username").val("");
      

    });

    // å—ä¿¡å‡¦ç†
    newPostRef.on("child_added", function (data)
    {
      let v = data.val(); //ã“ã“ã«ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒå…¨ã¦å…¥ã£ã¦ãã‚‹
      let k = data.key; //ä»Šå›ã¯ä½¿ã„ã¾ã›ã‚“

      console.log(d);
      let str = `
        <dl id=chat__text>
          <dt><img class="chicon" src='img/${ img[v.icon] }'></dt>
          <dd>åå‰ï¼š${ v.username }<br>${ v.text }<br>${ v.time }</dd>
        </dl>`;
      // ã“ã“ã§ãƒ‡ãƒ¼ã‚¿ã‚’htmlã«åŸ‹ã‚è¾¼ã‚€
      $("#output").prepend(str);

    })

    $("#text").on("keydown", function (e)
    {

      console.log(e)
      if (e.keyCode === 13)
      {

        newPostRef.push({
          username: $("#username").val(),
          text: $("#text").val(),
          icon: d,
          time: t,
        })
        $("#text").val("");
        $("#username").val("");

      }
    })


  </script>
<!-- <footer>
  (c) G's Reserved.
</footer> -->

</body>

</html>